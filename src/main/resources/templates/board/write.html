<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>게시글 작성</title>
	<link rel="stylesheet" href="/static/css/write.css" />
</head>
<body>
<div class="container">
    <h1 th:switch="${boardType}">
        <span th:case="1">동네 맛집 글쓰기</span>
        <span th:case="2">지역 먹거리 축제 글쓰기</span>
        <span th:case="3">오늘의 레시피 글쓰기</span>
        <span th:case="4">푸드 커뮤니티 글쓰기</span>
        <span th:case="5">점심 메뉴 추천 글쓰기</span>
        <span th:case="*">알 수 없음</span>
    </h1>
    
    <!-- boardType 포함한 글 등록 요청 -->
    <form th:action="@{/board/type/{boardType}/write(boardType=${boardType})}" method="post">
        <input type="hidden" name="boardType" th:value="${board.boardType}" />

        <label for="boardTitle">제목:</label>
        <input type="text" id="boardTitle" name="boardTitle" required /><br/>

        <label>유형:</label>
        <span th:switch="${board.boardType}">
            <span th:case="1">동네 맛집</span>
            <span th:case="2">지역 먹거리 축제</span>
            <span th:case="3">오늘의 레시피</span>
            <span th:case="4">푸드 커뮤니티</span>
            <span th:case="5">점심 메뉴 추천</span>
            <span th:case="*">알 수 없음</span>
        </span><br/>

        <label for="boardComment">내용:</label>
        <textarea id="boardComment" name="boardComment" rows="5" cols="40" required></textarea><br/>
		
		<input type="file" id="file" multiple />
		<ul id="imageList"></ul>
		
		<!-- 목록 링크 버튼화 -->
	    <div class="button-group">
			<button type="submit">등록</button>
	        <a class="button" th:href="@{/board/type/{boardType}(boardType=${boardType})}">목록으로</a>
	    </div>
    </form>
	<script>
		document.querySelector('#file')
			.addEventListener('change', function(e){
				console.log(e.target.files)
				const formData = new FormData();
				for (let i = 0; i < e.target.files.length; i++) {
					formData.append('files', e.target.files[i]);
				}
				fetch('/api/file/save', {
					method: 'post',
					body: formData
				}).then(res => res.json())
				.then(data => {
					console.log(data);
					if (data.length > 0) {
						const ul = document.querySelector('#imageList');
						data.forEach(item => {
							const li = document.createElement('li');
							const image = document.createElement('img');
							image.classList.add('resultImage');
							image.src = `/api/file/view/fileName/${item.fileName}`
							li.append(image);
							ul.append(li);
						})
					}
				});
			})
	</script>
</div>
</body>
</html>