<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ì ì‹¬ ë©”ë‰´ ì¶”ì²œ</title>
    <link rel="stylesheet" href="/static/css/recommend.css" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.0.2/TweenMax.min.js"></script>
	<script src="/static/js/Winwheel.min.js"></script>
</head>

<body>
	<header>
	   <div class="img">
	     <img src="https://img.icons8.com/emoji/96/bento-box-emoji.png" alt="Lunch Icon">
	   </div>
	   <h1 style="text-align:center">ì˜¤ëŠ˜ ë­ ë¨¹ì§€? ğŸ½ï¸</h1>
	   <div class="sub-title">ì˜¤ëŠ˜ ë­ ë¨¹ì§€? ê³ ë¯¼ ë~ ğŸ™</div>
	 </header>
	 
<div class="recommend-box">
    <select id="mealType" onchange="updateNextSelect('mealType')">
        <option value="" hidden>ì‹ì‚¬ ì¢…ë¥˜ ì„ íƒ</option>
        <option value="meal">ì‹ì‚¬</option>
        <option value="cook">ìš”ë¦¬</option>
        <option value="snack">ê°„ì‹</option>
    </select>

    <select id="foodStyle" onchange="updateNextSelect('foodStyle')" disabled>
        <option value="" hidden>ìŒì‹ ì¢…ë¥˜ ì„ íƒ</option>
        <option value="korean">í•œì‹</option>
        <option value="chinese">ì¤‘ì‹</option>
        <option value="japanese">ì¼ì‹</option>
        <option value="western">ì–‘ì‹</option>
        <option value="asian">ì•„ì‹œì•„</option>
    </select>

    <select id="situation" disabled>
        <option value="" hidden>ìƒí™© ì„ íƒ</option>
        <option value="alone">í˜¼ë°¥</option>
        <option value="friend">ì¹œêµ¬</option>
        <option value="date">ì—°ì¸</option>
        <option value="family">ê°€ì¡±</option>
        <option value="group">ëª¨ì„</option>
    </select>
	
	<canvas id="wheelcanvas" width="500" height="500"></canvas>
	<button onclick="spinWheel()">ë£°ë › ëŒë¦¬ê¸°!</button>
	<div id="wheelResult" style="text-align: center; margin-top: 20px; font-size: 1.2em;"></div>

	<div class="button-group" style="display:flex; gap:10px; justify-content:center; flex-wrap: wrap;">
	  <button onclick="recommendMenu()">ì¶”ì²œë°›ê¸°</button>
	  <button onclick="reRecommendMenu()">ë‹¤ì‹œ ì¶”ì²œ!</button>
	</div>
	<div id="recommendationArea">
	  <div id="rouletteWrapper">
	    <div id="roulette"></div>
	  </div>
	</div>
<script>
    const menuMap = {
		// ğŸš meal (ì‹ì‚¬)
	   "meal_korean_alone": ["ê¹€ì¹˜ì°Œê°œ", "ëœì¥ì°Œê°œ", "ì œìœ¡ë®ë°¥", "ë¹„ë¹”ë°¥", "ìˆœë‘ë¶€ì°Œê°œ"],
	   "meal_chinese_family": ["ë§ˆë¼íƒ•", "ì–‘ì¥í”¼", "íŒ”ë³´ì±„", "ê¹í’ê¸°", "ìœ ì‚°ìŠ¬"],
	   "meal_japanese_friend": ["ê·œë™", "ê°€ì¸ ë™", "ë¼ë©˜", "ìŠ¤ì‹œ", "ìš°ë™"],
	   "meal_western_date": ["íŒŒìŠ¤íƒ€", "ìŠ¤í…Œì´í¬", "ìƒëŸ¬ë“œë³¼", "í”¼ì", "í¬ë¦¼ë¦¬ì¡°ë˜"],
	   "meal_asian_group": ["íŒŸíƒ€ì´", "ë°˜ë¯¸", "í¬", "ë¯¸ê³ ë­", "ë‚˜ì‹œê³ ë "],

	   // ğŸ³ cook (ìš”ë¦¬ ì¤‘ì‹¬)
	   "cook_korean_family": ["ë¶ˆê³ ê¸°", "ë‹­ê°ˆë¹„", "ê°ˆë¹„ì°œ", "ì¡ì±„", "ë–¡ê°ˆë¹„"],
	   "cook_chinese_date": ["ê¹í’ê¸°", "ì¹ ë¦¬ìƒˆìš°", "ê¿”ë°”ë¡œìš°", "ë§ˆíŒŒë‘ë¶€", "íƒ•ìˆ˜ìœ¡"],
	   "cook_japanese_alone": ["ì˜¤ì½”ë…¸ë¯¸ì•¼ë¼", "íƒ€ì½”ì•¼ë¼", "ì¹´ë ˆ", "ëˆì½”ì¸ ë¼ë©˜", "ê°€ë¼ì•„ê²Œ"],
	   "cook_western_date": ["ìŠ¤í…Œì´í¬", "ë¼ìëƒ", "ì¹˜í‚¨ ì»¤í‹€ë¦¿", "ë¡œìŠ¤íŠ¸ ì¹˜í‚¨", "ê°ë°”ìŠ¤"],
	   "cook_asian_friend": ["ë‚˜ì‹œê³ ë ", "íŒŸíƒ€ì´", "ì‚¬ë–¼", "ë³¶ìŒêµ­ìˆ˜", "ì¶˜ê¶Œ"],

	   // ğŸª snack (ê°„ì‹/ë¶„ì‹ë¥˜)
	   "snack_korean_friend": ["ë–¡ë³¶ì´", "ìˆœëŒ€", "ê¹€ë°¥", "ì˜¤ë…", "ë¼ë©´"],
	   "snack_chinese_alone": ["ê½ˆë°°ê¸°", "íƒ•í›„ë£¨", "ë§Œë‘", "ì¶˜ê¶Œ", "ê³¼ì¼íƒ•"],
	   "snack_japanese_date": ["ëª¨ì°Œ", "ë„ë¼ì•¼ë¼", "íŒ¥ë¹™ìˆ˜", "í‘¸ë”©", "ë§ˆì°¨ ì•„ì´ìŠ¤í¬ë¦¼"],
	   "snack_western_group": ["ê°ìíŠ€ê¹€", "í•«ë„ê·¸", "í”„ë ˆì¦", "ë² ì´ê¸€", "ì»µì¼€ì´í¬"],
	   "snack_asian_group": ["ë‚˜ì‹œê³ ë ", "íŒŸíƒ€ì´", "ë°˜ë¯¸", "ë°”ë‚˜ë‚˜ íŠ€ê¹€", "ì¶˜ê¶Œ"]
    };

    function updateNextSelect(changed) {
        if (changed === 'mealType') {
            document.getElementById('foodStyle').disabled = false;
            document.getElementById('situation').disabled = true;
        }
        if (changed === 'foodStyle') {
            document.getElementById('situation').disabled = false;
        }
    }

	let lastKey = null;

	function getRandomItem(arr) {
	    return arr[Math.floor(Math.random() * arr.length)];
	}
	
	let theWheel;

	function setupWheel(menuList) {
	    theWheel = new Winwheel({
			canvasId: "wheelcanvas",
	        numSegments: menuList.length,
	        outerRadius: 200,
	        textFontSize: 16,
	        segments: menuList.map(name => ({ fillStyle: getRandomColor(), text: name })),
	        animation: {
	            type: 'spinToStop',
	            duration: 5,
	            spins: 8,
	            callbackFinished: function (indicatedSegment) {
	                document.getElementById('wheelResult').innerHTML =
	                    `ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë©”ë‰´ëŠ” <strong>${indicatedSegment.text}</strong>ì…ë‹ˆë‹¤! ğŸ½ï¸`;
	            }
	        }
	    });
	}

	function getRandomColor() {
	    const colors = ['#FFB6C1', '#FFD700', '#98FB98', '#ADD8E6', '#FFA07A', '#DDA0DD'];
	    return colors[Math.floor(Math.random() * colors.length)];
	}

	function spinWheel() {
	    if (!theWheel) {
	        alert("ë¨¼ì € ì¶”ì²œí•  ë©”ë‰´ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”!");
	        return;
	    }
	    theWheel.startAnimation();
	}

	function recommendMenu() {
	    const type = document.getElementById("mealType").value;
	    const category = document.getElementById("foodStyle").value;
	    const situation = document.getElementById("situation").value;

	    if (!type || !category || !situation) {
	        alert("ëª¨ë“  ì„ íƒì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!");
	        return;
	    }

	    const key = `${type}_${category}_${situation}`;
	    lastKey = key;

	    let menuOptions = menuMap[key];  // ì´ê±° ë¨¼ì € ì„ ì–¸í•´ì£¼ê³ 

	    console.log("ì¶”ì²œ ë©”ë‰´ í˜¸ì¶œë¨!", key, menuOptions);  // ìš”ê±° ë‚˜ì¤‘ì—!

	    if (!menuOptions) {
	        const allMenus = Object.values(menuMap).flat();
	        const backup = getRandomItem(allMenus);
	        document.getElementById("wheelResult").innerHTML = `ì¶”ì²œí•  ë©”ë‰´ê°€ ì—†ì–´ ëŒ€ì‹  <strong>${backup}</strong>ì„ ì¶”ì²œí•´ìš”! ğŸ˜‹`;
	        return;
	    }

	    setupWheel(menuOptions);

	    setTimeout(() => {
	        spinWheel();
	    }, 100);
		document.getElementById('wheelcanvas').style.display = 'block';  
	}
</script>
</body>
</html>