<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ì ì‹¬ ë©”ë‰´ ì¶”ì²œ</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.0.2/TweenMax.min.js"></script>
	<script src="/static/js/Winwheel.min.js"></script>
	<style>
		:root {
		  --primary-color: #ff7f50;
		  --light-bg: #f4f5f7;
		  --text-color: #333;
		  --accent-color: #ff7f50;
		  --box-bg: #ffffff;
		  --box-shadow: 0 12px 32px rgba(0, 0, 0, 0.08);
		}

		body {
		  font-family: "Segoe UI", "Pretendard", sans-serif;
		  background-color: var(--light-bg);
		  margin: 0;
		  padding: 0;
		  color: var(--text-color);
		}

		header .img {
		  text-align: center;
		  padding: 20px 0;
		}

		header img {
		  height: 80px;
		}

		h1 {
		  font-size: 28px;
		  text-align: center;
		  color: var(--primary-color);
		  margin-top: 0;
		  padding-top: 20px;
		  font-weight: 700;
		}

		.sub-title {
		  text-align: center;
		  font-size: 20px;
		  color: #555;
		  margin-top: -10px;
		  opacity: 0;
		  animation: fadeIn 1s ease forwards;
		  animation-delay: 0.5s;
		}

		@keyframes fadeIn {
		  to {
		    opacity: 1;
		  }
		}

		.recommend-box {
		  display: flex;
		  flex-direction: column;
		  gap: 16px;
		  max-width: 420px;
		  margin: 30px auto;
		  padding: 30px 24px;
		  background-color: var(--box-bg);
		  border-radius: 16px;
		  box-shadow: var(--box-shadow);
		  text-align: center;
		  position: relative;
		}

		.recommend-box img {
		  width: 64px;
		  margin: 0 auto -8px;
		  animation: float 2s ease-in-out infinite;
		}

		@keyframes float {
		  0%, 100% { transform: translateY(0); }
		  50% { transform: translateY(-6px); }
		}

		select {
		  padding: 12px;
		  font-size: 16px;
		  border: 1px solid #ddd;
		  border-radius: 8px;
		  appearance: none;
		  background-color: #fff;
		  transition: border-color 0.3s;
		}

		select:focus {
		  outline: none;
		  border-color: var(--primary-color);
		  box-shadow: 0 0 0 3px rgba(255, 127, 80, 0.2);
		}

		button, a.btn {
		  padding: 12px;
		  font-size: 16px;
		  background: linear-gradient(to right, #ff7f50, #ffa07a);
		  color: white;
		  border: none;
		  border-radius: 10px;
		  font-weight: 600;
		  cursor: pointer;
		  transition: background-color 0.3s, transform 0.2s ease;
		  box-shadow: 0 6px 12px rgba(255, 127, 80, 0.2);
		}

		button:hover, a.btn:hover {
		  transform: translateY(-2px);
		}

		#recommendationResult {
		  margin-top: 20px;
		  font-size: 18px;
		  color: var(--primary-color);
		  font-weight: bold;
		}

		@media (max-width: 500px) {
		  .recommend-box {
		    padding: 20px 16px;
		    gap: 12px;
		  }

		  select, button {
		    font-size: 15px;
		    padding: 10px;
		  }

		  #recommendationResult {
		    font-size: 16px;
		  }
		}

		@keyframes fadeInDown {
		  0% {
		    opacity: 0;
		    transform: translate(-50%, -20px);
		  }
		  100% {
		    opacity: 1;
		    transform: translate(-50%, 0);
		  }
		}

		#wheel-indicator {
		  position: absolute;
		  top: 220px;
		  left: 50%;
		  transform: translateX(-50%);
		  width: 0;
		  height: 0;
		  border-left: 15px solid transparent;
		  border-right: 15px solid transparent;
		  border-top: 25px solid red;
		  z-index: 10;
		  
		  opacity: 0; /* ì´ˆê¸°ì—” ìˆ¨ê¹€ */
		  animation-fill-mode: forwards;
		}
		
		a.btn {
		  text-decoration: none;
		}
	</style>
</head>

<body>
	<header>
	   <h1 style="text-align:center">ì˜¤ëŠ˜ ë­ ë¨¹ì§€? ğŸ½ï¸</h1>
	   <div class="sub-title">ì˜¤ëŠ˜ ë­ ë¨¹ì§€? ê³ ë¯¼ ë~ ğŸ™</div>
	 </header>
	 
<div class="recommend-box">
    <select id="mealType" onchange="updateNextSelect('mealType')">
        <option value="" hidden>ì‹ì‚¬ ì¢…ë¥˜ ì„ íƒ</option>
        <option value="meal">ì‹ì‚¬</option>
        <option value="cook">ìš”ë¦¬</option>
        <option value="snack">ê°„ì‹</option>
    </select>

    <select id="foodStyle" onchange="updateNextSelect('foodStyle')" disabled>
        <option value="" hidden>ìŒì‹ ì¢…ë¥˜ ì„ íƒ</option>
        <option value="korean">í•œì‹</option>
        <option value="chinese">ì¤‘ì‹</option>
        <option value="japanese">ì¼ì‹</option>
        <option value="western">ì–‘ì‹</option>
        <option value="asian">ì•„ì‹œì•„</option>
    </select>

    <select id="situation" disabled>
        <option value="" hidden>ìƒí™© ì„ íƒ</option>
        <option value="alone">í˜¼ë°¥</option>
        <option value="friend">ì¹œêµ¬</option>
        <option value="date">ì—°ì¸</option>
        <option value="family">ê°€ì¡±</option>
        <option value="group">ëª¨ì„</option>
    </select>
	
	<canvas id="wheelcanvas" width="500" height="500"></canvas>
	<!--button onclick="spinWheel()">ë£°ë › ëŒë¦¬ê¸°!</button-->
	<div id="wheel-indicator"></div>
	<div id="wheelResult" style="text-align: center; margin-top: 20px; font-size: 1.2em;"></div>

	<div class="button-group" style="display:flex; gap:10px; justify-content:center; flex-wrap: wrap;">
	  <button onclick="recommendMenu()">ì¶”ì²œë°›ê¸°!</button>
	  <button onclick="reRecommendMenu()">ë‹¤ì‹œ ì¶”ì²œ!</button>
	  <a href="/" class="btn">í™ˆìœ¼ë¡œ!</a>
	</div>
	<div id="recommendationArea">
	  <div id="rouletteWrapper">
	    <div id="roulette"></div>
	  </div>
	</div>
	<script>
	    const menuMap = {
			// ğŸš meal (ì‹ì‚¬)
		   "meal_korean_alone": ["ê¹€ì¹˜ì°Œê°œ", "ëœì¥ì°Œê°œ", "ì œìœ¡ë®ë°¥", "ë¹„ë¹”ë°¥", "ìˆœë‘ë¶€ì°Œê°œ"],
		   "meal_chinese_family": ["ë§ˆë¼íƒ•", "ì–‘ì¥í”¼", "íŒ”ë³´ì±„", "ê¹í’ê¸°", "ìœ ì‚°ìŠ¬"],
		   "meal_japanese_friend": ["ê·œë™", "ê°€ì¸ ë™", "ë¼ë©˜", "ìŠ¤ì‹œ", "ìš°ë™"],
		   "meal_western_date": ["íŒŒìŠ¤íƒ€", "ìŠ¤í…Œì´í¬", "ìƒëŸ¬ë“œë³¼", "í”¼ì", "í¬ë¦¼ë¦¬ì¡°ë˜"],
		   "meal_asian_group": ["íŒŸíƒ€ì´", "ë°˜ë¯¸", "í¬", "ë¯¸ê³ ë­", "ë‚˜ì‹œê³ ë "],
	
		   // ğŸ³ cook (ìš”ë¦¬ ì¤‘ì‹¬)
		   "cook_korean_family": ["ë¶ˆê³ ê¸°", "ë‹­ê°ˆë¹„", "ê°ˆë¹„ì°œ", "ì¡ì±„", "ë–¡ê°ˆë¹„"],
		   "cook_chinese_date": ["ê¹í’ê¸°", "ì¹ ë¦¬ìƒˆìš°", "ê¿”ë°”ë¡œìš°", "ë§ˆíŒŒë‘ë¶€", "íƒ•ìˆ˜ìœ¡"],
		   "cook_japanese_alone": ["ì˜¤ì½”ë…¸ë¯¸ì•¼ë¼", "íƒ€ì½”ì•¼ë¼", "ì¹´ë ˆ", "ëˆì½”ì¸ ë¼ë©˜", "ê°€ë¼ì•„ê²Œ"],
		   "cook_western_date": ["ìŠ¤í…Œì´í¬", "ë¼ìëƒ", "ì¹˜í‚¨ ì»¤í‹€ë¦¿", "ë¡œìŠ¤íŠ¸ ì¹˜í‚¨", "ê°ë°”ìŠ¤"],
		   "cook_asian_friend": ["ë‚˜ì‹œê³ ë ", "íŒŸíƒ€ì´", "ì‚¬ë–¼", "ë³¶ìŒêµ­ìˆ˜", "ì¶˜ê¶Œ"],
	
		   // ğŸª snack (ê°„ì‹/ë¶„ì‹ë¥˜)
		   "snack_korean_friend": ["ë–¡ë³¶ì´", "ìˆœëŒ€", "ê¹€ë°¥", "ì˜¤ë…", "ë¼ë©´"],
		   "snack_chinese_alone": ["ê½ˆë°°ê¸°", "íƒ•í›„ë£¨", "ë§Œë‘", "ì¶˜ê¶Œ", "ê³¼ì¼íƒ•"],
		   "snack_japanese_date": ["ëª¨ì°Œ", "ë„ë¼ì•¼ë¼", "íŒ¥ë¹™ìˆ˜", "í‘¸ë”©", "ë§ˆì°¨ ì•„ì´ìŠ¤í¬ë¦¼"],
		   "snack_western_group": ["ê°ìíŠ€ê¹€", "í•«ë„ê·¸", "í”„ë ˆì¦", "ë² ì´ê¸€", "ì»µì¼€ì´í¬"],
		   "snack_asian_group": ["ë‚˜ì‹œê³ ë ", "íŒŸíƒ€ì´", "ë°˜ë¯¸", "ë°”ë‚˜ë‚˜ íŠ€ê¹€", "ì¶˜ê¶Œ"]
	    };
	
	    function updateNextSelect(changed) {
	        if (changed === 'mealType') {
	            document.getElementById('foodStyle').disabled = false;
	            document.getElementById('situation').disabled = true;
	        }
	        if (changed === 'foodStyle') {
	            document.getElementById('situation').disabled = false;
	        }
	    }
	
		let lastKey = null;
	
		function getRandomItem(arr) {
		    return arr[Math.floor(Math.random() * arr.length)];
		}
		
		let theWheel;
	
		function setupWheel(menuList) {
		    // ìƒ‰ìƒ ë°°ì—´ (ë©”ë‰´ ê°œìˆ˜ ì´ìƒìœ¼ë¡œ ì¶©ë¶„íˆ ì¤€ë¹„)
		    const colors = [
					'#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231',
			        '#911eb4', '#46f0f0', '#f032e6', '#bcf60c', '#fabebe',
			        '#008080', '#e6beff', '#9a6324', '#fffac8', '#808080',
			        '#aaffc3', '#808000', '#ffd8b1'
			];
	
		    // ìƒ‰ìƒì„ ì„ê¸°
		    const shuffledColors = colors.sort(() => 0.5 - Math.random());
	
		    theWheel = new Winwheel({
		        canvasId: "wheelcanvas",
		        numSegments: menuList.length,
		        outerRadius: 200,
		        textFontSize: 16,
		        segments: menuList.map((name, idx) => ({
		            fillStyle: shuffledColors[idx % shuffledColors.length],  // ìƒ‰ì„ ìˆœí™˜í•´ì„œ ê³ ë¥´ê²Œ
		            text: name
		        })),
		        animation: {
		            type: 'spinToStop',
		            duration: 5,
		            spins: 8,
		            callbackFinished: function (indicatedSegment) {
		                document.getElementById('wheelResult').innerHTML =
		                    `ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë©”ë‰´ëŠ” <strong>${indicatedSegment.text}</strong>ì…ë‹ˆë‹¤! ğŸ½ï¸`;
		            }
		        }
		    });
		}
	
		function spinWheel() {
		    if (!theWheel) {
		        alert("ë¨¼ì € ì¶”ì²œí•  ë©”ë‰´ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”!");
		        return;
		    }
		    theWheel.startAnimation();
		}
		
		function showIndicator() {
		  const indicator = document.getElementById('wheel-indicator');
		  indicator.style.opacity = '1';
		  indicator.style.animation = 'fadeInDown 0.5s ease forwards';
		}
	
		function recommendMenu() {
		    const type = document.getElementById("mealType").value;
		    const category = document.getElementById("foodStyle").value;
		    const situation = document.getElementById("situation").value;
	
		    if (!type || !category || !situation) {
		        alert("ëª¨ë“  ì„ íƒì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!");
		        return;
		    }
	
		    const key = `${type}_${category}_${situation}`;
		    lastKey = key;
	
		    let menuOptions = menuMap[key];
	
		    if (!menuOptions) {
		        const allMenus = Object.values(menuMap).flat();
		        const backup = getRandomItem(allMenus);
		        document.getElementById("wheelResult").innerHTML = `ì¶”ì²œí•  ë©”ë‰´ê°€ ì—†ì–´ ëŒ€ì‹  <strong>${backup}</strong>ì„ ì¶”ì²œí•´ìš”! ğŸ˜‹`;
		        return;
		    }
	
		    setupWheel(menuOptions);
			
			showIndicator();
	
		    setTimeout(() => {
		        spinWheel();
		    }, 100);
			document.getElementById('wheelcanvas').style.display = 'block';
		}
		
		function reRecommendMenu() {
		    if (!lastKey || !menuMap[lastKey]) {
		        alert("ë¨¼ì € ì¶”ì²œ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!");
		        return;
		    }
		    setupWheel(menuMap[lastKey]);
			
			setTimeout(() => {
			       spinWheel();
			}, 100);
		}  
	</script>
</body>
</html>